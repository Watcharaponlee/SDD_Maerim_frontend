<template>
    <div class="pa-3">
        <v-row>
            <v-col cols="10" class="pa-2">
                <div>
                    <v-card variant="flat" style="box-shadow: rgba(100, 100, 111, 0.2) 0px 5px 29px 0px;">
                        <v-toolbar density="compact" color="white"
                            style="border-top-left-radius: 4px;border-top-right-radius: 4px;">
                            <h2 class="ml-5 d-flex align-center justify-start" style="color: #FE8329;">
                                <v-icon icon="mdi-calendar-check" size="small" class="mr-2"
                                    style="color: #FE8329;"></v-icon>
                                ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤ - ‡∏≠‡∏≠‡∏Å
                            </h2>
                            <v-spacer></v-spacer>
                            <p style="color: black;font-weight: 600;font-size: 25px;"
                                class="d-flex align-center justify-center pr-5">
                                <v-icon icon="mdi-clock" size="small" class="mr-2" color="primary"></v-icon>
                                {{ currentTime }}
                            </p>
                        </v-toolbar>
                        <v-row class="justify-space-between pa-3">
                            <v-col cols="6" class="pa-5" v-for="stu in studentData" :key="stu._id">
                                <v-row class="pb-2">
                                    <v-col>
                                        <img :src="stu.img_name || '/profile_mockup.jpg'" alt="img" class="ImgBorder">
                                    </v-col>
                                    <v-col>
                                        <img :src="stu.img_snap ? baseUrl + stu.img_snap : '/profile_mockup.jpg'"
                                            alt="Img" class="ImgBorder">
                                    </v-col>
                                </v-row>

                                <div class="d-flex align-center justify-center">
                                    <v-card variant="flat" class="card-second-shadow" style="width: 80%;">
                                        <h2 class="text-center pa-1" style="background-color: #FE8329;color: white;">
                                            ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                                        </h2>
                                        <div class="pa-3">
                                            <v-row class="align-center row-border">
                                                <v-col cols="3" class="text-center pa-0">
                                                    <v-icon style="color: #005BB9; font-size: 35px;"
                                                        icon="mdi-card-account-details" />
                                                </v-col>
                                                <v-col cols="9" class="pa-2">
                                                    <p class="FontDetail text-center">{{ stu.p_id || '-' }}</p>
                                                </v-col>
                                            </v-row>
                                            <v-row class="align-center row-border">
                                                <v-col cols="3" class="text-center pa-0">
                                                    <v-icon style="color: #005BB9; font-size: 35px;"
                                                        icon="mdi-account" />
                                                </v-col>
                                                <v-col cols="9" class="pa-2">
                                                    <p class="text-center FontDetail">{{ cutPrefixName(stu.name) || '-'
                                                    }}
                                                    </p>
                                                </v-col>
                                            </v-row>
                                            <v-row class="align-center">
                                                <v-col cols="3" class="text-center pa-0">
                                                    <v-icon style="color: #43A047;font-size: 35px;"
                                                        icon="mdi-clock-check" />
                                                </v-col>
                                                <v-col cols="9" class="pa-2">
                                                    <p class="text-center FontDetail">{{ extractTime(stu.time) || '-' }}
                                                    </p>
                                                </v-col>
                                            </v-row>
                                        </div>
                                    </v-card>
                                </div>

                            </v-col>
                        </v-row>
                    </v-card>
                </div>

                <div class="mt-3">
                    <v-card variant="flat" style="box-shadow: rgba(100, 100, 111, 0.2) 0px 5px 29px 0px;">
                        <v-toolbar density="compact" color="white"
                            style="border-top-left-radius: 4px;border-top-right-radius: 4px;">
                            <h2 class="ml-5 d-flex align-center justify-start" style="color: #FE8329;">
                                <v-icon icon="mdi-account" size="small" class="mr-2" style="color: #FE8329;"></v-icon>
                                ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                            </h2>
                            <v-spacer></v-spacer>
                        </v-toolbar>
                        <v-row class="text-center pa-3">
                            <v-col v-for="student in data" :key="student._id">
                                <img :src="student.img_name || '/profile_mockup.jpg'" alt="img" class="Imglist">

                                <v-row class="align-center pa-2 pt-5">
                                    <v-col cols="4" class="text-center pa-0">
                                        <v-icon style="color: #005BB9; " icon="mdi-card-account-details" />
                                    </v-col>
                                    <v-col cols="8" class="pa-0 pt-2">
                                        <p class="d-flex align-center justify-center FontSub">
                                            {{ student.p_id || '-' }}
                                        </p>
                                    </v-col>

                                    <v-col cols="4" class="text-center pa-0 py-2">
                                        <v-icon style="color: #43A047;" icon="mdi-clock-check" />
                                    </v-col>
                                    <v-col cols="8" class="pa-0">
                                        <p class="d-flex align-center justify-center FontSub">
                                            {{ extractTime(student.time) || '-' }}
                                        </p>
                                    </v-col>
                                </v-row>


                                <!-- <p class="d-flex align-center justify-center FontSub">
                            <v-icon style="color: #005BB9;" icon="mdi-account" class="mr-3" />
                            {{ cutPrefixName(student.name) }}

                        </p> -->
                                <!-- <p class="d-flex align-center justify-center FontSub">
                            <v-icon style="color: #43A047;" icon="mdi-clock-check" class="mr-3" />
                            {{ extractTime(student.time) }}
                        </p> -->
                            </v-col>
                        </v-row>
                    </v-card>
                </div>
            </v-col>
            <v-col cols="2" class="pa-2 pl-0">
                <v-card variant="flat" style="box-shadow: rgba(100, 100, 111, 0.2) 0px 5px 29px 0px;">
                    <v-toolbar density="compact" color="#EF5350"
                        style="border-top-left-radius: 4px;border-top-right-radius: 4px;">
                        <h3 class="ml-5 d-flex align-center justify-start" style="color: white;">
                            <v-icon icon="mdi-account-cancel-outline" size="small" class="mr-2"
                                style="color: white;"></v-icon>
                            ‡∏™‡πÅ‡∏Å‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                        </h3>
                    </v-toolbar>
                    <div>
                        <v-divider></v-divider>
                        <v-col v-for="str in strangerData" :key="str.timeST" class="text-center pb-0">
                            <div style="position: relative;">
                                <p class="absolutePosition"><v-icon style="font-size: 40px;"
                                        color="red">mdi-close-thick</v-icon>
                                </p>
                                <img :src="str.img_snap ? baseUrl + str.img_snap : '/profile_mockup.jpg'" alt="img"
                                    class="ImgStr">
                                <v-row class="pa-1 pt-0">
                                    <v-col cols="6" class="text-end pr-1"><v-icon size="large"
                                            color="orange">mdi-clock-alert</v-icon></v-col>
                                    <v-col cols="6" class="text-start pl-1">
                                        <p class="FontSub">
                                            {{ extractTime(str.time) || '-' }}</p>
                                    </v-col>
                                </v-row>
                                <v-divider></v-divider>
                            </div>
                        </v-col>
                    </div>
                </v-card>
            </v-col>
        </v-row>
    </div>
</template>

<script>
import { formatitemdevice, dateTimeFormatValue } from '../../function/day';
import moment from "moment-timezone"
export default {
    setup() {
        const baseUrl = import.meta.env.VITE_APP_BASE_URL;
        return {
            formatitemdevice,
            dateTimeFormatValue,
            baseUrl,
        };
    },
    data: () => ({
        studentData: [
            {
                Img: '/profile_mockup.jpg',
                p_id: "",
                name: "",
                time: ""
            },
            {
                Img: '/profile_mockup.jpg',
                p_id: "",
                name: "",
                time: ""
            },
        ],
        currentTime: moment().tz('Asia/Bangkok').format('DD/MM/YYYY HH:mm:ss'),
        deviceInfo: {
            serialNumber: '',
            location: '',
            name: '',
        },
        data: [
            {
                Img: '/profile_mockup.jpg',
                Id: "",
                name: "",
                timeST: ""
            },
            {
                Img: '/profile_mockup.jpg',
                Id: "",
                name: "",
                timeST: ""
            },
            {
                Img: '/profile_mockup.jpg',
                Id: "",
                name: "",
                timeST: ""
            },
            {
                Img: '/profile_mockup.jpg',
                Id: "",
                name: "",
                timeST: ""
            },
            {
                Img: '/profile_mockup.jpg',
                Id: "",
                name: "",
                timeST: ""
            },
            {
                Img: '/profile_mockup.jpg',
                Id: "",
                name: "",
                timeST: ""
            },
            {
                Img: '/profile_mockup.jpg',
                Id: "",
                name: "",
                timeST: ""
            },
            {
                Img: '/profile_mockup.jpg',
                Id: "",
                name: "",
                timeST: ""
            },
            {
                Img: '/profile_mockup.jpg',
                Id: "",
                name: "",
                timeST: ""
            },
        ],
        serverTime: '',
        headers: [
            { title: '‡∏•‡∏≥‡∏î‡∏±‡∏ö', align: 'center', sortable: false, key: 'index' },
            { title: '‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û', align: 'center', sortable: false, key: 'data.snapPicture' },
            { title: '‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•', align: 'center', sortable: false, key: 'data.name' },
            { title: '‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô', align: 'center', sortable: false, key: 'data.position' },
            { title: '‡πÄ‡∏ß‡∏•‡∏≤', align: 'center', sortable: false, key: 'data.timestamp' },

        ],
        studentCounter: 0,
        FirstName: '',
        LastName: '',
        socket: null,
        socketReconnectTimeout: null, // <- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ clearTimeout
        isComponentAlive: true, // <- flag ‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡πÄ‡∏ä‡πá‡∏Å‡∏ß‡πà‡∏≤ component ‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏´‡∏°
        lastClearedHour: null,
        clearInterval: null,
        strangerData: [
            {
                Img: '/profile_mockup.jpg',
                Id: "",
                name: "",
                timeST: ""
            },
            {
                Img: '/profile_mockup.jpg',
                Id: "",
                name: "",
                timeST: ""
            },
            {
                Img: '/profile_mockup.jpg',
                Id: "",
                name: "",
                timeST: ""
            },
            {
                Img: '/profile_mockup.jpg',
                Id: "",
                name: "",
                timeST: ""
            },
            {
                Img: '/profile_mockup.jpg',
                Id: "",
                name: "",
                timeST: ""
            },
        ],
    }),
    created() {
        setInterval(() => {
            this.currentTime = moment().tz('Asia/Bangkok').format('DD/MM/YYYY HH:mm:ss');
        }, 1000);
    },
    mounted() {
        this.deviceInfo.serialNumber = this.$route.query.serial;
        this.deviceInfo.location = this.$route.query.location;
        this.deviceInfo.name = this.$route.query.name;

        this.connectWebSocket();
        this.setupDataClearTimer();

        window.addEventListener('beforeunload', this.disconnectWebSocket);
        window.addEventListener('online', this.handleOnline);
        window.addEventListener('offline', this.handleOffline);
    },
    beforeUnmount() {
        this.isComponentAlive = false;

        if (this.socket) {
            this.socket.close();
        }

        if (this.socketReconnectTimeout) {
            clearTimeout(this.socketReconnectTimeout);
            this.socketReconnectTimeout = null;
        }

        console.log("Component destroyed, WS disconnected.");

        if (this.clearInterval) {
            clearInterval(this.clearInterval);
            this.clearInterval = null;
        }

        window.removeEventListener('online', this.handleOnline);
        window.removeEventListener('offline', this.handleOffline);
        if (this.socket) {
            this.socket.close();
        }
    },
    methods: {
        disconnectWebSocket() {
            if (this.socket && this.socket.readyState === WebSocket.OPEN) {
                this.socket.close(1000, 'User navigated away');
                console.log('WebSocket disconnected on page leave.');
            }
        },
        getSocketUrl() {
            const isDevLocalhost = window.location.hostname === 'localhost' && window.location.port === '5173';

            if (isDevLocalhost) {
                // ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å .env ‡∏ï‡∏≠‡∏ô dev
                return import.meta.env.VITE_APP_SOCKET_URL;
            } else {
                // ‡πÉ‡∏ä‡πâ hostname ‡∏à‡∏£‡∏¥‡∏á ‡πÅ‡∏ï‡πà path ‡πÅ‡∏•‡∏∞ port ‡πÄ‡∏î‡∏¥‡∏°
                const protocol = 'ws'; // ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ wss ‡∏ñ‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ https
                const hostname = window.location.hostname;
                return `${protocol}://${hostname}:3050/socket`;
            }
        },

        // const reconnectWebSocket = () => {
        //     console.log('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...');
        //     if (navigator.onLine) {
        //         connectWebSocket();
        //     } else {
        //         console.log('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï, ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏¥‡∏ô‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô...');
        //     }
        // }

        // window.addEventListener('online', () => {
        //     reconnectWebSocket();
        // });

        // window.addEventListener('offline', () => {
        //     console.log('‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠');
        // });

        connectWebSocket() {
            const socketUrl = this.getSocketUrl();
            this.socket = new WebSocket(socketUrl);

            this.socket.onopen = () => {
                console.log('Connected !')
            };

            this.socket.onmessage = (event) => {
                const socketData = JSON.parse(event.data);

                if (socketData.sn === this.deviceInfo.serialNumber) {
                    if (socketData.p_id !== 'STRANGERBABY') {
                        if (this.studentData.length === 2) {
                            const removed = this.studentData.pop();
                            this.data.unshift(removed); // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏∏‡∏î

                            // ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÉ‡∏´‡πâ data ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10
                            if (this.data.length > 8) {
                                this.data.pop();
                            }
                        }

                        // ‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤ studentData
                        this.studentData.unshift(socketData);

                        console.log('üìå studentData (‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î 2):', this.studentData);
                        console.log('üì¶ data (‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤ ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 8):', this.data);

                    } else if (socketData.p_id === 'STRANGERBABY') {
                        this.strangerData.unshift(socketData);

                        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô 5 ‡πÑ‡∏´‡∏° ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏ö‡∏≠‡∏±‡∏ô‡πÄ‡∏Å‡πà‡∏≤‡∏™‡∏∏‡∏î
                        if (this.strangerData.length > 5) {
                            this.strangerData.length = 5; // ‡∏ï‡∏±‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 5 ‡∏ï‡∏±‡∏ß (‡∏•‡∏ö‡∏ó‡πâ‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)
                        }

                    }
                }
            };

            this.socket.onerror = (error) => {
                console.log('WebSocket Error', error)
            };

            this.socket.onclose = () => {
                console.log('Connection Closed!');
                // ‡πÄ‡∏ä‡πá‡∏Å‡∏Å‡πà‡∏≠‡∏ô reconnect
                if (this.isComponentAlive) {
                    console.log('Attempting to reconnect in 3 seconds...');
                    this.socketReconnectTimeout = setTimeout(() => {
                        this.connectWebSocket();
                    }, 3000);
                }
            }
        },
        reconnectWebSocket() {
            console.log('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...');
            if (navigator.onLine) {
                this.connectWebSocket();
            } else {
                console.log('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï');
            }
        },
        handleOnline() {
            console.log('‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡πÅ‡∏•‡πâ‡∏ß');
            this.reconnectWebSocket();
        },
        handleOffline() {
            console.log('‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï');
            if (this.socket && this.socket.readyState !== WebSocket.CLOSED) {
                this.socket.close();
            }
        },
        setupDataClearTimer() {
            this.clearInterval = setInterval(() => {
                const now = new Date();
                const currentTime = now.getTime(); // timestamp

                const clearHours = [9, 19]; // 09:00 ‡πÅ‡∏•‡∏∞ 19:00
                const clearWindow = 5 * 60 * 1000; // 5 ‡∏ô‡∏≤‡∏ó‡∏µ ‡πÄ‡∏õ‡πá‡∏ô ms

                for (const hour of clearHours) {
                    const clearTime = new Date(now);
                    clearTime.setHours(hour, 0, 0, 0); // set ‡πÄ‡∏õ‡πá‡∏ô hh:00:00

                    const clearTimestamp = clearTime.getTime();

                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5 ‡∏ô‡∏≤‡∏ó‡∏µ ‡πÅ‡∏•‡∏∞‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ
                    const shouldClear =
                        currentTime >= clearTimestamp &&
                        currentTime <= clearTimestamp + clearWindow &&
                        this.lastClearedAt !== clearTimestamp;

                    if (shouldClear) {
                        console.log(`üßπ Auto-clearing at ${hour}:00`);
                        this.data = [];
                        this.studentData.picture = null;
                        this.studentData.snapPicture = null;
                        this.lastClearedAt = clearTimestamp;
                        this.strangerData = [];
                    }
                }

                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏¢ clear window ‡πÅ‡∏•‡πâ‡∏ß ‚Üí reset ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÑ‡∏î‡πâ‡∏£‡∏≠‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
                if (this.lastClearedAt) {
                    const allWindowsPassed = clearHours.every(hour => {
                        const clearTime = new Date(now);
                        clearTime.setHours(hour, 0, 0, 0);
                        const clearTimestamp = clearTime.getTime();
                        return currentTime > clearTimestamp + clearWindow;
                    });
                    if (allWindowsPassed) {
                        this.lastClearedAt = null;
                    }
                }
            }, 10000); // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ó‡∏∏‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        },

        //     if (this.socket) {
        //         this.socket.close();
        //     }
        // },
        extractTime(dateTimeString) {
            if (!dateTimeString) return null;

            const date = new Date(dateTimeString);

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ date ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (isNaN(date.getTime())) return null;

            const hour = date.getHours().toString().padStart(2, '0');
            const minute = date.getMinutes().toString().padStart(2, '0');
            return `${hour}:${minute}`;
        },
        cutPrefixName(name) {
            if (name) {
                return name.replace(/^(‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢|‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á|‡∏ô‡∏≤‡∏¢|‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß)/, '').trim();
            }
        },
        cutName(name) {
            if (name) {
                // ‡∏ï‡∏±‡∏î‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤
                const newName = name.replace(/^(‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢|‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á|‡∏ô‡∏≤‡∏¢|‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß)/, '').trim();

                // ‡πÅ‡∏¢‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•
                const [firstName, ...lastName] = newName.split(' ');

                // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡∏•‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£
                this.FirstName = firstName || '';
                this.LastName = lastName.join(' ') || '';
            } else {
                this.FirstName = '';
                this.LastName = '';
            }
        },
        cutNameParts(name) {
            if (!name) return { first: '', last: '' };

            const trimmed = name.replace(/^(‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢|‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á|‡∏ô‡∏≤‡∏¢|‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß)/, '').trim();
            const [first, ...last] = trimmed.split(' ');

            return {
                first: first || '',
                last: last.join(' ') || ''
            };
        }
    },
}
</script>

<style scoped>
.ImgBorder {
    /* padding: 10px; */
    border-radius: 5px;
    width: 100%;
    height: 389px;
    box-shadow: rgba(149, 157, 165, 0.2) 0px 8px 24px;

}

.Imglist {
    border-radius: 5px;
    height: 140px;
    margin-bottom: 5px;
}

.ImgStr {
    border-radius: 5px;
    height: 132px;
    margin-bottom: 5px;
}

.FontDetail {
    font-size: 24px;
    font-weight: 600;
}

.FontSub {
    font-size: 22px;
    font-weight: 500;
}

.FontHeader {
    font-size: 19px;
    font-weight: bold;
    text-align: center;
}

.overflow-y-auto {
    overflow-y: auto;
}

.card-second-shadow {
    box-shadow: rgba(0, 0, 0, 0.05) 0px 6px 24px 0px, rgba(0, 0, 0, 0.08) 0px 0px 0px 1px;
}

.row-border {
    border-bottom: 1px solid #E0E0E0;
}

.absolutePosition {
    position: absolute;
    z-index: 10;
    right: 80px;
}
</style>